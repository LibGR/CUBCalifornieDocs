{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p># Documentation de l'agence CUB Hong-Kong</p> <p>Bienvenue sur la documentation CUB Hong-Kong produite en Markdown et avec Mkdocs...</p>"},{"location":"Documentations/Linux/TOTP/","title":"TOTP ETCKEEPER DNS","text":""},{"location":"Documentations/Linux/TOTP/#1-mise-en-place-de-totp-ssh-avec-otp-sur-debian-12","title":"1. Mise en place de TOTP (SSH avec OTP sur Debian 12)","text":""},{"location":"Documentations/Linux/TOTP/#reinstallation-complete","title":"R\u00e9installation compl\u00e8te","text":"<ol> <li>Nettoyage de l\u2019ancienne configuration</li> </ol> <pre><code>sudo rm -f /etc/security/users.oath\n</code></pre> <ol> <li>Installation des paquets n\u00e9cessaires</li> </ol> <pre><code>sudo apt update\nsudo apt install -y libpam-oath oathtool openssh-server\n</code></pre> <ol> <li>G\u00e9n\u00e9ration d\u2019un nouveau secret</li> </ol> <pre><code>sudo -i\nKEY=$(openssl rand -hex 20)\necho \"HOTP/T30/6 etudiant - ${KEY}\" &gt; /etc/security/users.oath\n</code></pre> <ol> <li>V\u00e9rification et s\u00e9curisation</li> </ol> <pre><code>cat /etc/security/users.oath\nchown root:root /etc/security/users.oath\nchmod 600 /etc/security/users.oath\n</code></pre> <ol> <li>Configuration de PAM</li> </ol> <pre><code>sudo nano /etc/pam.d/sshd\n</code></pre> <p>Ajouter/commenter :</p> <p><pre><code>#@include common-auth\n\nauth required pam_unix.so nullok_secure\nauth required pam_oath.so usersfile=/etc/security/users.oath window=30 digits=6\n</code></pre> Exclure un utilisateur de TOTP <pre><code>auth [success=1 default=ignore] pam_succeed_if.so user = [UTILISATEUR]\n</code></pre></p> <ol> <li>Configuration SSH</li> </ol> <pre><code>sudo nano /etc/ssh/sshd_config\n</code></pre> <p>Ajouter/commenter :</p> <pre><code>#KbdInteractiveAuthentication no\n\nChallengeResponseAuthentication yes\nUsePAM yes\n</code></pre> <p>Puis red\u00e9marrer :</p> <pre><code>sudo systemctl restart ssh\n</code></pre> <ol> <li>R\u00e9cup\u00e9ration de la cl\u00e9 pour l\u2019application OTP</li> </ol> <pre><code>HEX=$(grep etudiant /etc/security/users.oath | awk '{print $4}')\noathtool -v -d 6 $HEX\n</code></pre> <ol> <li>G\u00e9n\u00e9ration du QR code</li> </ol> <pre><code>qrencode -o etudiant.png 'otpauth://totp/etudiant@192.168.1.90?secret=TA_CLE_BASE32'\n</code></pre> <ol> <li>V\u00e9rification de la synchronisation NTP</li> </ol> <pre><code>timedatectl\nsudo apt install systemd-timesyncd\nsudo systemctl enable --now systemd-timesyncd\n</code></pre> <ol> <li>Test de connexion</li> </ol> <pre><code>ssh etudiant@192.168.1.90\n</code></pre> <p>Fonctionne</p>"},{"location":"Documentations/Linux/TOTP/#2-gestion-de-etc-avec-etckeeper","title":"2. Gestion de /etc avec etckeeper","text":"<ol> <li>Installation</li> </ol> <pre><code>sudo apt install etckeeper\netckeeper --version\n</code></pre> <ol> <li>Initialisation Git</li> </ol> <pre><code>sudo etckeeper init\nsudo etckeeper commit \"Commit initial pour /etc\"\n</code></pre> <ol> <li>Configuration</li> </ol> <pre><code>sudoedit /etc/etckeeper/etckeeper.conf\n</code></pre> <p>V\u00e9rifier :</p> <pre><code>VCS=\"git\"\n</code></pre> <ol> <li>Int\u00e9gration avec APT</li> </ol> <pre><code>sudo apt install nginx\ncd /etc\nsudo git log\n</code></pre> <ol> <li>Gestion des m\u00e9tadonn\u00e9es</li> </ol> <pre><code>PRESERVE_METADATA=\"yes\"\n</code></pre> <ol> <li>Sauvegarde et restauration</li> </ol> <pre><code>sudo tar czf etc-backup.tar.gz /etc\nsudo tar xzf etc-backup.tar.gz -C /\ncd /etc\nsudo git log --oneline\n</code></pre>"},{"location":"Documentations/Linux/TOTP/#3-mise-en-place-dunbound-dns-recursif","title":"3. Mise en place d\u2019Unbound (DNS r\u00e9cursif)","text":"<ol> <li>Installation</li> </ol> <pre><code>sudo apt install unbound\n</code></pre> <ol> <li>Cr\u00e9ation d\u2019une configuration personnalis\u00e9e</li> </ol> <pre><code>sudo nano /etc/unbound/unbound.conf.d/cub.conf\n</code></pre> <p>Contenu :</p> <pre><code>server:\n    interface: 192.168.3.61\n    interface: 127.0.0.1\n    access-control: 192.168.3.0/25 allow\n    access-control: 192.168.3.128/26 allow\n    access-control: 192.168.3.192/28 allow\n    access-control: 127.0.0.0/8 allow\n    access-control: 0.0.0.0/0 refuse\n    hide-version: yes\n    hide-identity: yes\n    do-ip4: yes\n    verbosity: 3\n</code></pre> <p>3. Red\u00e9marrage du service</p> <pre><code>sudo systemctl restart unbound\n</code></pre>"},{"location":"Documentations/Windows%20Serveur%202019/RDP/","title":"Liaison s\u00e9curis\u00e9e avec le bureau \u00e0 distance - RDP","text":""},{"location":"Documentations/Windows%20Serveur%202019/RDP/#activation-du-rdp-cote-serveur","title":"Activation du RDP cot\u00e9 serveur :","text":"<p>Dans le tableau de contr\u00f4le du serveur :</p> <p></p> <p>Activer le bureau RDP:</p> <p></p> <p></p> <p>Pour r\u00e9soudre le message d'erreur, activez cette r\u00e8gle dans le par-feu :</p> <p></p>"},{"location":"Documentations/Windows%20Serveur%202019/RDP/#connexion-depuis-un-poste-windows","title":"Connexion depuis un poste Windows :","text":"<p>Lancer l'application du bureau \u00e0 distance :</p> <p></p> <p>Entrez l'adresse du serveur est accepter le certificat :</p> <p></p> <p></p> <p>L'acc\u00e8s \u00e0 distance est fonctionnel :</p> <p>Pour cela, l'utilisateur doit \u00eatre dans le groupe Administrateurs ou Bureau \u00e0 distance</p> <p></p>"},{"location":"Documentations/Windows%20Serveur%202019/SSH/","title":"Liaison s\u00e9curis\u00e9e avec le terminal - SSH","text":"<p>Pour pouvoir installer OpenSSH Server sans notre infrastructure, cette configuration r\u00e9seau : </p>"},{"location":"Documentations/Windows%20Serveur%202019/SSH/#i-installation-dopenssh-server","title":"I. Installation d'OpenSSH Server","text":""},{"location":"Documentations/Windows%20Serveur%202019/SSH/#ii-activation-dopenssh-server","title":"II. Activation d'OpenSSH Server","text":""},{"location":"Documentations/Windows%20Serveur%202019/SSH/#iii-connection-depuis-un-poste-externe","title":"III. Connection depuis un poste externe","text":"<p>Connexion depuis un poste linux :</p> <pre><code>etudiant@S406-P10-L:~$ ssh Administrateur@172.16.53.1\nAdministrateur@172.16.53.1's password: 700_buC700_buC\n</code></pre> <p>La connexion est bien r\u00e9ussi :\u00a0</p> <pre><code>Microsoft Windows [version 10.0.17763.2114]\n(c) 2018 Microsoft Corporation. Tous droits r\u00e9serv\u00e9s.\n\nadministrateur@SERVEURPRIMAIRE C:\\Users\\Administrateur&gt;\n</code></pre>"},{"location":"Documentations/Windows%20Serveur%202019/SSH/#iv-securisation-du-serveur-ssh","title":"IV. S\u00e9curisation du serveur SSH :","text":""},{"location":"Documentations/Windows%20Serveur%202019/SSH/#creation-du-compte-dedie-ssh","title":"Cr\u00e9ation du compte d\u00e9di\u00e9 SSH:","text":"<pre><code>etudiant@S406-P10-L:~$ ssh adminssh@172.16.53.1\nadminssh@172.16.53.1's password: Cub_Admin_Ssh_007\n\nMicrosoft Windows [version 10.0.17763.2114]\n(c) 2018 Microsoft Corporation. Tous droits r\u00e9serv\u00e9s.\n\nadminssh@SERVEURPRIMAIRE C:\\Users\\adminssh&gt;\n</code></pre>"},{"location":"Documentations/Windows%20Serveur%202019/SSH/#desactivation-de-la-connexion-au-compte-administrateur","title":"D\u00e9sactivation de la connexion au compte Administrateur :","text":"<p>Ouvrir:</p> <pre><code>C:\\ProgramData\\ssh\\sshd_config\n</code></pre> <p>Commenter ses deux lignes :</p> <pre><code># Match Group administrators\n# AuthorizedKeysFile __PROGRAMDATA__/ssh/administrators_authorized_keys\n</code></pre> <p>Ajout de la ligne en bas de fichier :</p> <pre><code>DenyUsers Administrateur\n</code></pre> <p>Red\u00e9marage du service :</p> <p></p> <p>La connexion est rendu impossible :</p> <pre><code>etudiant@S406-P10-L:~$ ssh Administrateur@172.16.53.1\nAdministrateur@172.16.53.1's password: \nPermission denied, please try again.\nAdministrateur@172.16.53.1's password: \nPermission denied, please try again.\nAdministrateur@172.16.53.1's password: \nAdministrateur@172.16.53.1: Permission denied (publickey,password,keyboard-interactive).\n</code></pre>"},{"location":"Documentations/Windows%20Serveur%202019/SSH/#modification-du-port-par-defaut","title":"Modification du port par defaut :","text":"<p>Ouvrir:</p> <pre><code>C:\\ProgramData\\ssh\\sshd_config\n</code></pre> <p>Changer la ligne de port pour :</p> <pre><code>Port 222\n</code></pre> <p>Mettre une nouvelle r\u00e8gle sur le parfeu via le powershell :</p> <p><pre><code>PS C:\\Users\\adminssh&gt; New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Serve\nr (sshd) - Port 222' -Enabled True -Direction Inbound -Protocol TCP -Action Allo\nw -LocalPort 222\n</code></pre> </p> <p>Red\u00e9marrer le service via powershell:</p> <pre><code>PS C:\\Users\\adminssh&gt; Restart-Service \"sshd\"\n</code></pre> <p>Connexion avec le nouveau port :</p> <pre><code>etudiant@S406-P10-L:~$ ssh adminssh@172.16.53.1\n\netudiant@S406-P10-L:~$ ssh -p 222 adminssh@172.16.53.1\nadminssh@172.16.53.1's password: \n\nMicrosoft Windows [version 10.0.17763.2114]\n(c) 2018 Microsoft Corporation. Tous droits r\u00e9serv\u00e9s.\n\nadminssh@SERVEURPRIMAIRE C:\\Users\\adminssh&gt;\n</code></pre>"},{"location":"Infrastructure/planDAdressage/","title":"Plan d'adressage","text":""},{"location":"Infrastructure/planDAdressage/#vlan-53-production","title":"VLAN 53 \u2014 Production","text":"<p>60 \u00d7 2 = 120 appareils 2\u2077 - 2 = 126 32 - 7 = 25 CIDR /25</p> Octet 1 Octet 2 Octet 3 Octet 4 Adresse d\u00e9cimale @R\u00e9seau 1100.0000 1010.1000 0000.0011 0000.0000 192.168.3.0 Masque 1111.1111 1111.1111 1111.1111 1000.0000 255.255.255.128 @Passerelle 1100.0000 1010.1000 0000.0011 0111.1110 192.168.3.126 @Diffusion 1100.0000 1010.1000 0000.0011 0111.1111 192.168.3.127"},{"location":"Infrastructure/planDAdressage/#vlan-10-client-1","title":"VLAN 10 \u2014 Client 1","text":"<p>16 \u00d7 2 = 32 appareils 2\u2076 - 2 = 62 32 - 6 = 26 CIDR /27</p> Octet 1 Octet 2 Octet 3 Octet 4 Adresse d\u00e9cimale @R\u00e9seau 1100.0000 1010.1000 0000.0011 1000.0000 192.168.3.128 Masque 1111.1111 1111.1111 1111.1111 1100.0000 255.255.255.192 @Passerelle 1100.0000 1010.1000 0000.0011 1011.1110 192.168.3.190 @Diffusion 1100.0000 1010.1000 0000.0011 1011.1111 192.168.3.191"},{"location":"Infrastructure/planDAdressage/#vlan-20-administration-systeme-et-reseaux","title":"VLAN 20 \u2014 Administration syst\u00e8me et r\u00e9seaux","text":"<p>3 \u00d7 2 = 6 appareils 2\u2074 - 2 = 14 32 - 4 = 28 CIDR /28</p> Octet 1 Octet 2 Octet 3 Octet 4 Adresse d\u00e9cimale @R\u00e9seau 1100.0000 1010.1000 0000.0011 1100.0000 192.168.3.192 Masque 1111.1111 1111.1111 1111.1111 1111.0000 255.255.255.240 @Passerelle 1100.0000 1010.1000 0000.0011 1100.1110 192.168.3.206 @Diffusion 1100.0000 1010.1000 0000.0011 1100.1111 192.168.3.207"},{"location":"Infrastructure/tableRoutageNat/","title":"Les tables de routage et Nat","text":""},{"location":"Infrastructure/tableRoutageNat/#tables-de-routage","title":"Tables de routage","text":""},{"location":"Infrastructure/tableRoutageNat/#commutateur-de-niveau-3","title":"Commutateur de niveau 3","text":"Destination Masque Passerelle Interface Type 192.168.3.0 255.255.255.128 192.168.3.126 192.168.3.126 Connect\u00e9 192.168.3.128 255.255.255.192 192.168.3.190 192.168.3.190 Connect\u00e9 192.168.3.192 255.255.255.240 192.168.3.206 192.168.3.206 Connect\u00e9 192.168.33.248 255.255.255.240 192.168.33.253 192.168.33.253 Connect\u00e9 0.0.0.0 0.0.0.0 192.168.33.254 192.168.33.253 Statique"},{"location":"Infrastructure/tableRoutageNat/#firewall-stormsheld","title":"Firewall Stormsheld","text":"Destination Masque Passerelle Interface Type 192.36.3.0 255.255.255.0 192.36.3.254 192.36.3.254 Connect\u00e9 192.168.33.248 255.255.255.240 192.168.33.254 192.168.33.254 Connect\u00e9 192.36.253.0 255.255.255.0 192.36.253.30 192.36.253.30 Connect\u00e9 192.168.3.0 255.255.255.0 192.168.33.253 192.168.33.254 Statique 0.0.0.0 0.0.0.0 192.36.253.254 192.36.253.30 Statique"},{"location":"Infrastructure/tableRoutageNat/#table-de-nat","title":"Table de NAT","text":"IP Source (avant) Port Source (avant) IP Destination (avant) Port Distant (avant) IP Source (apr\u00e8s) Port Source (apr\u00e8s) IP Destination (apr\u00e8s) Port Distant (apr\u00e8s) 192.168.3.0/24 * * * 192.36.253.30/24 * * *"}]}